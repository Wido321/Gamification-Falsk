{% extends "base.html" %}
{% block title %}Storico{% endblock %}
{% block content %}
<div class="tabella-container">
  <table class="tabella-moderna">
    <thead>
      <tr>
        <th>Data</th>
        <th>Nome</th>
        <th>Difficoltà</th>
        <th>Risultato</th>
        <th>Elimina</th>
      </tr>
    </thead>
    <tbody>
      {% for entry in storico_data %}
      <tr>
        <td>{{ entry.data.strftime('%Y-%m-%d') }}</td>
        <td>{{ entry.cognome }}</td>
        <td>{{ entry.difficolta | capitalize }}</td>
        <td>{{ entry.risultato | capitalize }}</td>
        <td><button onclick="deleteEntry({{ entry.id }})" style="font-size:2.2rem; font-weight:700; color:#fff; background:linear-gradient(135deg,#4158d0,#c850c0); border:none; border-radius:50%; width:48px; height:48px; box-shadow:0 4px 16px rgba(65,88,208,0.18); display:flex; align-items:center; justify-content:center; cursor:pointer; transition:transform 0.15s;">-</button></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Confirmation Overlay -->
<div id="confirmation-overlay" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(26,11,46,0.85); z-index:4500; justify-content:center; align-items:center;">
  <div style="background:rgba(255,255,255,0.08); border-radius:24px; box-shadow:0 8px 32px rgba(107,43,255,0.2); padding:36px 28px; text-align:center; font-family:'Poppins',sans-serif; font-size:1.9rem; color:#fff; max-width:520px; position:relative;">
    <button id="cancel-confirmation" style="position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.2); color: #fff; border: none; border-radius: 50%; width: 30px; height: 30px; font-size: 1.2rem; font-weight: bold; cursor: pointer;">×</button>
    <div style="font-size: 4rem; margin-bottom: 20px;">☢️</div>
    <div id="confirmation-text" style="margin-bottom:24px; font-size:2rem; font-weight:700;">Attenzione</div>
    <div id="confirmation-message" style="margin-bottom:24px; font-size:1.5rem;"></div>
    <div style="display:flex; justify-content:center; gap:12px;">
      <button id="confirm-action" style="background:linear-gradient(135deg,#f44336,#d32f2f); color:#fff; font-size:1.1rem; font-weight:700; border:none; border-radius:12px; padding:12px 20px; cursor:pointer;">Conferma</button>
      <button id="cancel-action" style="background:linear-gradient(135deg,#4caf50,#2e7d32); color:#fff; font-size:1.1rem; font-weight:700; border:none; border-radius:12px; padding:12px 20px; cursor:pointer;">Annulla</button>
    </div>
  </div>
</div>

<script>
// Confirmation overlay functions
let confirmCallback = null;
function showConfirmation(message, callback) {
  document.getElementById('confirmation-message').textContent = message;
  confirmCallback = callback;
  document.getElementById('confirmation-overlay').style.display = 'flex';
}
function hideConfirmation() {
  document.getElementById('confirmation-overlay').style.display = 'none';
  confirmCallback = null;
}
document.getElementById('confirm-action').addEventListener('click', function() {
  if (confirmCallback) confirmCallback();
  hideConfirmation();
});
document.getElementById('cancel-action').addEventListener('click', hideConfirmation);
document.getElementById('cancel-confirmation').addEventListener('click', hideConfirmation);

function deleteEntry(id) {
    showConfirmation('Sei sicuro di voler eliminare questa voce dallo storico? Questo toglierà il cerchio dalla tabella e sottrarrà i punti.', () => {
        fetch('/delete_storico', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ id: id }),
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Errore nell\'eliminazione');
            }
        });
    });
}
</script>
{% endblock %}
<style>
@import url('https://fonts.googleapis.com/css?family=Poppins:400,500,600,700&display=swap');
body {
  font-family: 'Poppins', 'Segoe UI', Arial, sans-serif;
  background: #f2f2f2;
}
.tabella-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 70vh;
  width: 100%;
  padding: 32px 0;
  overflow-x: auto;
}
.tabella-moderna {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  background: #fff;
  box-shadow: 0 8px 32px rgba(65,88,208,0.10);
  border-radius: 18px;
  overflow: hidden;
  margin: 0 auto;
  border: 1.5px solid #c850c0;
}
.tabella-moderna th {
  background: linear-gradient(-135deg, #c850c0, #4158d0);
  color: #fff;
  font-size: 1.15rem;
  font-weight: 700;
  padding: 20px 12px;
  border-bottom: 2px solid #4158d0;
  text-align: center;
  letter-spacing: 0.5px;
}
.tabella-moderna td {
  padding: 18px 10px;
  border-bottom: 1px solid #e3e6ee;
  text-align: center;
  font-size: 1.05rem;
  background: #fff;
  transition: background 0.2s;
}
.tabella-moderna tbody tr:nth-child(even) td {
  background: #f7f2fa;
}
.tabella-moderna tbody tr:hover td {
  background: #e9e9f7;
}
@media (max-width: 1024px) and (min-width: 901px) {
  .tabella-moderna {
    width: 100%;
    max-width: none;
  }
  .tabella-moderna th {
    font-size: 1rem;
    padding: 16px 8px;
  }
  .tabella-moderna td {
    padding: 14px 6px;
    font-size: 0.95rem;
  }
}
@media (max-width: 900px) {
  .tabella-moderna {
    width: 100%;
    font-size: 0.95rem;
    border-radius: 10px;
    box-shadow: 0 2px 12px rgba(65,88,208,0.10);
  }
  .tabella-moderna th, .tabella-moderna td {
    padding: 10px 4px;
    font-size: 0.95rem;
  }
}
</style>
